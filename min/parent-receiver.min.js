(function(){"use strict";var I="LADB-2026-EDLEY-7X9K2",E="1.0.0",A="20260127",x="Q29weXJpZ2h0IDIwMjYgQnJhbmRvbiBFZGxleS4gTGljZW5zZWQgZm9yIExBIE9SRVMgb25seS4=",d=document.currentScript||document.querySelector("script[data-la-bridge]");if(!d){console.error("[LA-Bridge] Could not find script element. Add data-la-bridge attribute.");return}var r={measurementId:d.dataset.measurementId||null,mode:d.dataset.mode||"auto",eventPrefix:d.dataset.eventPrefix||"la_",allowedOrigins:(d.dataset.allowedOrigins||"https://book.mylimobiz.com").split(",").map(function(t){return t.trim()}),debug:d.dataset.debug==="true",iframeSelector:d.dataset.iframeSelector||'iframe[src*="book.mylimobiz.com"]',minHeight:parseInt(d.dataset.minHeight,10)||400,maxHeight:parseInt(d.dataset.maxHeight,10)||2e3,enableHeightResize:d.dataset.enableHeightResize!=="false"};function i(){if(r.debug){var t=["[LA-Bridge]"].concat(Array.prototype.slice.call(arguments));console.log.apply(console,t)}}i("Config loaded:",r);var s=r.mode,l=r.measurementId;function g(){if(window.dataLayer&&Array.isArray(window.dataLayer))for(var t=0;t<window.dataLayer.length;t++){var e=window.dataLayer[t];if(e&&e[0]==="config"&&typeof e[1]=="string"&&e[1].startsWith("G-"))return e[1]}if(window.google_tag_data&&window.google_tag_data.tidr){for(var a=Object.keys(window.google_tag_data.tidr),n=0;n<a.length;n++)if(a[n].startsWith("G-"))return a[n]}return null}function c(){r.mode==="gtag"||r.mode==="dataLayer"?s=r.mode:r.measurementId?s="gtag":typeof window.gtag=="function"?(s="gtag",l=g()):s="dataLayer",i("Resolved mode:",s,"Measurement ID:",l||"(auto)")}var _={purchase:{name:"purchase",params:["transaction_id","value","currency","items","coupon","shipping","tax"]},begin_checkout:{name:"begin_checkout",params:["value","currency","items","coupon"]},add_to_cart:{name:"add_to_cart",params:["value","currency","items"]},view_item:{name:"view_item",params:["value","currency","items"]},view_item_list:{name:"view_item_list",params:["item_list_id","item_list_name","items"]},select_item:{name:"select_item",params:["item_list_id","item_list_name","items","value","currency"]},add_payment_info:{name:"add_payment_info",params:["value","currency","payment_type","items","coupon"]},add_shipping_info:{name:"add_shipping_info",params:["value","currency","shipping_tier","items","coupon"]},form_start:{name:"form_start",params:["form_id","form_name","form_destination","first_field"]}};function v(t,e){if(typeof window.gtag!="function")return i("gtag not available, falling back to dataLayer"),u(t,e),!1;var a={},n=_[t];n?n.params.forEach(function(o){e[o]!==void 0&&(a[o]=e[o])}):(a=Object.assign({},e),delete a.event),l&&(a.send_to=l),i("Firing gtag:",t,a);try{return window.gtag("event",t,a),!0}catch(o){return i("gtag error:",o),u(t,e),!1}}function u(t,e){window.dataLayer=window.dataLayer||[];var a=r.eventPrefix+t,n={event:a};return Object.keys(e).forEach(function(o){o!=="event"&&(n[r.eventPrefix+o]=e[o])}),i("Pushing to dataLayer:",n),window.dataLayer.push(n),!0}function p(t,e){return i("Handling event:",t,e),e&&e._debug_only?(delete e._debug_only,u(t,e)):s==="gtag"?v(t,e):u(t,e)}var m=null;function y(){return m&&document.contains(m)||(m=document.querySelector(r.iframeSelector)),m}function h(t){if(!r.enableHeightResize){i("Height resize disabled, ignoring height:",t);return}var e=y();if(!e){i("No iframe found with selector:",r.iframeSelector);return}var a=Math.max(r.minHeight,Math.min(r.maxHeight,t));e.style.height=a+"px",i("Updated iframe height:",a,"(raw:",t+")")}var f={};function w(t){return r.allowedOrigins.indexOf("*")!==-1?!0:r.allowedOrigins.indexOf(t)!==-1}function b(t){if(w(t.origin)){var e=t.data;if(!(!e||!e.type)){if(e.type==="LA_IFRAME_HEIGHT"){typeof e.height=="number"&&e.height>0&&h(e.height);return}if(e.type==="LA_DATALAYER_EVENT"){var a=e.payload;if(!a||!a.eventName){i("Invalid payload:",e);return}if(!a.eventName.startsWith("gtm.")){var n=a.timestamp+"_"+a.eventName;if(f[n]){i("Duplicate event skipped:",a.eventName);return}f[n]=!0;var o=Object.keys(f);o.length>100&&delete f[o[0]],i("Received from",t.origin+":",a.eventName),p(a.eventName,a.data||{})}}}}}function L(){c(),window.addEventListener("message",b,!1),i("Receiver initialized. Listening for events from:",r.allowedOrigins.join(", ")),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:r.eventPrefix+"bridge_ready",la_bridge_mode:s,la_bridge_measurement_id:l||"auto"})}L()})();
