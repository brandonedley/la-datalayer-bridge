<script>
(function(){"use strict";var te="LADB-2026-EDLEY-7X9K2",ne="1.1.0",re="20260128",ie="Q29weXJpZ2h0IDIwMjYgQnJhbmRvbiBFZGxleS4gTGljZW5zZWQgZm9yIExBIE9SRVMgb25seS4=",T="LA_DATALAYER_EVENT",j="LA_IFRAME_HEIGHT",v="la_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),I=!1,M=5;function o(){I&&console.log.apply(console,["[LA-Bridge Sender]"].concat(Array.prototype.slice.call(arguments)))}function S(){try{return window.self!==window.top}catch{return!0}}function U(e){if(e.event)return e.event;if(e[0]==="event"&&e[1])return e[1];if(e.transactionId||e.transactionTotal)return"purchase";if(e.ecommerce)return"ecommerce";var t=Object.keys(e);return t.length>0&&t.length<=3?t.join("_"):"unknown"}function z(e,t){var r={event:t};if(e[0]==="event"&&e[2]){var n=e[2];return t==="purchase"&&(r.transaction_id=n.transaction_id,r.value=n.value,r.currency=n.currency||"USD"),r}return e.transactionId||e.transactionTotal?(r.transaction_id=e.transactionId,r.value=parseFloat(e.transactionTotal)||0,r.currency="USD",r):Object.assign(r,e)}function u(e){if(S()){var t=U(e);if(!(e[0]==="js"||e[0]==="config")){var r=z(e,t),n={type:T,payload:{eventName:t,data:r,rawData:e,timestamp:Date.now(),url:window.location.href,sessionId:v}};try{if(t==="purchase"&&Y()){o("Quote submission: firing generate_lead instead of purchase");var i={type:T,payload:{eventName:"generate_lead",data:{event:"generate_lead",lead_source:"quote_request",currency:"USD",value:0,transaction_id:r.transaction_id,booking_type:"quote",is_quote:!0},rawData:e,timestamp:Date.now(),url:window.location.href,sessionId:v}};window.parent.postMessage(i,"*"),o("Sent event: generate_lead");return}window.parent.postMessage(n,"*"),o("Sent event:",n.payload.eventName)}catch(a){o("Failed to send:",a)}}}}var q=0,p=null;function y(){var e=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight);if(e=Math.ceil(e)+1,Math.abs(e-q)>M&&e>0){q=e;try{window.parent.postMessage({type:j,height:e,sessionId:v},"*"),o("Sent height:",e)}catch(t){o("Failed to send height:",t)}}}function G(){p&&cancelAnimationFrame(p),p=requestAnimationFrame(function(){p=null,y()})}function V(){if(S()){if(typeof ResizeObserver<"u"){var e=new ResizeObserver(G);e.observe(document.body),e.observe(document.documentElement),o("ResizeObserver installed")}else o("ResizeObserver not available, using fallback"),setInterval(y,500);document.readyState==="complete"?y():window.addEventListener("load",y),o("Height observer setup complete")}}function A(){window.dataLayer=window.dataLayer||[];var e=window.dataLayer.push.bind(window.dataLayer);window.dataLayer.push=function(){var t=Array.prototype.slice.call(arguments);return t.forEach(function(r){r&&typeof r=="object"&&u(r)}),e.apply(window.dataLayer,t)},o("dataLayer interceptor installed"),window.dataLayer.forEach(function(t){t&&typeof t=="object"&&(t.event||t[0]==="event"&&t[1]||t.transactionId||t.transactionTotal)&&u(t)})}function N(){var e=window.dataLayer;Object.defineProperty(window,"dataLayer",{get:function(){return e},set:function(t){o("dataLayer reassignment detected"),e=t,Array.isArray(t)&&A()},configurable:!0})}var g={};function E(e){g[e]&&(g[e].observer.disconnect(),clearTimeout(g[e].timeout),delete g[e])}function Q(e){var t=e.key,r=e.selector,n=e.maxWait||1e4,i=e.onFound,a=e.onTimeout;E(t);var c=document.querySelectorAll(r);if(c.length>0){i(c);return}var f=new MutationObserver(function(){var d=document.querySelectorAll(r);d.length>0&&(E(t),i(d))});f.observe(document.body,{childList:!0,subtree:!0});var m=setTimeout(function(){E(t),a&&a()},n);g[t]={observer:f,timeout:m}}var P=!1;function w(e){if(!e||!window.crypto||!window.crypto.subtle)return Promise.resolve(null);var t=new TextEncoder().encode(e);return window.crypto.subtle.digest("SHA-256",t).then(function(r){return Array.from(new Uint8Array(r)).map(function(n){return n.toString(16).padStart(2,"0")}).join("")}).catch(function(){return null})}function W(e){if(!e)return null;if(e=e.trim().toLowerCase(),e.endsWith("@gmail.com")||e.endsWith("@googlemail.com")){var t=e.split("@");e=t[0].replace(/\./g,"")+"@"+t[1]}return e}function B(e){if(!e)return null;var t=e.replace(/\D/g,"");return t.length===10&&(t="1"+t),t.length>=10?"+"+t:null}function F(e){return e?e.trim().toLowerCase():null}function R(){var e={};try{var t=document.querySelector("#Passenger_Email"),r=document.querySelector("#Passenger_Phone"),n=document.querySelector("#Passenger_Phone_View"),i=document.querySelector("#Passenger_FirstName"),a=document.querySelector("#Passenger_LastName");t&&t.value&&(e.email=W(t.value)),r&&r.value?e.phone=B(r.value):n&&n.value&&(e.phone=B(n.value)),i&&i.value&&(e.first_name=F(i.value)),a&&a.value&&(e.last_name=F(a.value))}catch(c){o("Error collecting user data:",c)}return e}function L(e){var t=R(),r={},n=0,i=0;function a(){i===n&&e(Object.keys(r).length>0?r:null)}t.email&&(n++,w(t.email).then(function(c){c&&(r.sha256_email_address=c),i++,a()})),t.phone&&(n++,w(t.phone).then(function(c){c&&(r.sha256_phone_number=c),i++,a()})),t.first_name&&(n++,w(t.first_name).then(function(c){c&&(r.sha256_first_name=c),i++,a()})),t.last_name&&(n++,w(t.last_name).then(function(c){c&&(r.sha256_last_name=c),i++,a()})),n===0&&e(null)}function H(){if(!P){var e=R();if(!(!e.email&&!e.phone)){P=!0;var t=l();o("Ecommerce: add_contact_info captured ("+t+")"),L(function(r){u(_({event:"add_contact_info",user_data:r}))})}}}var s=null;function l(){if(s)return s;var e=document.querySelector("#BookType");if(e&&e.value)return s=e.value.toLowerCase(),o("Booking type from #BookType:",s),s;var t=document.querySelector('#step2RateSection button[onclick*="Quote"]');if(t)return s="quote",o("Booking type from button onclick: quote"),s;var r=document.querySelector("#step2RateSection button");return r&&r.textContent.toLowerCase().indexOf("quote")>=0?(s="quote",o("Booking type from button text: quote"),s):(s="trip",o("Booking type defaulting to: trip"),s)}function Y(){return l()==="quote"}function _(e){var t=l();return e.booking_type=t,e.is_quote=t==="quote",e}var b=null,x=!1;function k(){var e={};try{var t=document.querySelector("#ServiceTypeId");t&&t.selectedIndex>=0&&(e.service_type=t.options[t.selectedIndex].text);var r=document.querySelector("#PickupLocation");r&&(e.pickup=r.value);var n=document.querySelector("#DropoffLocation");n&&(e.dropoff=n.value);var i=document.querySelector("#PickUpDate");i&&(e.date=i.value);var a=document.querySelector("#PickUpTime");a&&(e.time=a.value)}catch{}return e}function Z(e){return e&&parseFloat(e.replace(/[^0-9.]/g,""))||0}function D(e){if(!e)return null;try{var t=e.querySelector(".vehicle-grid-item-title, .vehicle-grid-item-heading, h2, h4, h5"),r=e.querySelector(".vehicle-grid-item-price"),n=t?t.textContent.trim():"Vehicle",i=Z(r?r.textContent:"0"),a=n.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,"");return{item_id:a||"vehicle",item_name:n,item_category:"Vehicle",price:i,quantity:1}}catch{return null}}function J(){var e=[];try{var t=document.querySelectorAll("#step2RateSection .vehicle-grid-item");t.forEach(function(r,n){var i=D(r);i&&(i.index=n,e.push(i))})}catch{}return e}function X(e){var t={items:[],currency:"USD"};try{var r=e.closest(".vehicle-grid-item"),n=D(r);n&&(t.items.push(n),t.value=n.price,b=n)}catch{}return t}function O(){var e={currency:"USD",items:[]};return b&&(e.items.push(b),e.value=b.price),e}function K(){document.addEventListener("click",function(n){var i=n.target;(i.matches("#showRatesBtn")||i.closest("#showRatesBtn"))&&(o("Ecommerce: view_item_list requested, waiting for vehicles..."),Q({key:"view_item_list",selector:"#step2RateSection .vehicle-grid-item",maxWait:1e4,onFound:function(ee){var h=l();o("Ecommerce: view_item_list ("+ee.length+" vehicles, "+h+")"),u(_({event:"view_item_list",item_list_id:"vehicles",item_list_name:h==="quote"?"Available Vehicles (Quote)":"Available Vehicles",items:J(),form_data:k()}))},onTimeout:function(){o("Ecommerce: view_item_list skipped (validation failed or timeout)")}}));var a=i.closest("#step2RateSection .vehicle-grid-item-btn-holder button");if(a&&!i.closest("#showRatesBtn")){var c=l();o("Ecommerce: select_item ("+c+")");var f=X(a);u(_(Object.assign({event:"select_item"},f)))}var m=i.closest('#step3LoginForm button[type="submit"], #ContinueAsGuest, #btnContinueAsGuest');if(m||i.tagName==="BUTTON"&&i.textContent.toLowerCase().includes("continue as guest")){var c=l();o("Ecommerce: begin_checkout ("+c+")");var d=O();L(function(h){var C=_(Object.assign({event:"begin_checkout",form_data:k()},d));h&&(C.user_data=h,o("Enhanced Conversions: user_data attached")),u(C)})}},!0),document.addEventListener("change",function(n){if(n.target.matches("#PaymentTypeId")){var i=l();o("Ecommerce: add_payment_info ("+i+")");var a=n.target.options[n.target.selectedIndex],c=a&&a.text||"unknown",f=O();L(function(m){var d=_(Object.assign({event:"add_payment_info",payment_type:c,form_data:k()},f));m&&(d.user_data=m),u(d)})}},!0);var e="#PickUpDate, #PickUpTime, #PickupLocation, #DropoffLocation, #ServiceTypeId, #Passengers, #Luggage";function t(n){x||(x=!0,o("Form: form_start triggered by",n),u({event:"form_start",form_id:"booking_form",form_name:"Limo Booking Form",form_destination:window.location.href,first_field:n}))}document.addEventListener("focus",function(n){n.target.matches&&n.target.matches(e)&&t(n.target.id||n.target.name||"unknown")},!0),document.addEventListener("click",function(n){var i=n.target;if(i.matches&&(i.matches(e)||i.closest(".datepickerbutton, .timepicker"))){var a=i.closest(e)||i;t(a.id||a.name||"booking_field")}},!0),document.addEventListener("change",function(n){n.target.matches("#ServiceTypeId")&&t("ServiceTypeId")},!0);var r="#Passenger_Email, #Passenger_Phone, #Passenger_Phone_View";document.addEventListener("blur",function(n){n.target.matches&&n.target.matches(r)&&setTimeout(H,100)},!0),document.addEventListener("change",function(n){n.target.matches&&n.target.matches("#Passenger_Email")&&setTimeout(H,100)},!0),o("Ecommerce listeners installed")}function $(){if(o("Initializing session:",v),!S()){o("Not in iframe, sender disabled");return}A(),N(),K(),V(),I&&u({event:"la_bridge_init",la_session_id:v,la_widget_url:window.location.href,_debug_only:!0}),o("Sender initialized")}$()})();
</script>
